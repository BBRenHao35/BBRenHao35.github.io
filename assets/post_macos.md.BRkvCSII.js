import{_ as s,o as i,c as a,R as l}from"./chunks/framework.UjU5Kp2a.js";const e="/assets/pve_general.Xo23qyah.png",t="/assets/pve_os.6ydGaJie.png",p="/assets/pve_system.toPoSVhd.png",n="/assets/pve_disks.oPkKlzJH.png",h="/assets/pve_cpu.5d6BJoB1.png",k="/assets/pve_memory.6suzQzIb.png",r="/assets/pve_network.9-ogiRIN.png",o="/assets/pve_desktop.ZTfVz0Ad.png",d="/assets/pve_imgdesktop.xQVadFPt.png",_=JSON.parse('{"title":"PVE macOS安裝紀錄","description":"","frontmatter":{},"headers":[],"relativePath":"post/macos.md","filePath":"post/macos.md","lastUpdated":1742123402000}'),c={name:"post/macos.md"},F=l(`<h1 id="pve-macos安裝紀錄" tabindex="-1">PVE macOS安裝紀錄 <a class="header-anchor" href="#pve-macos安裝紀錄" aria-label="Permalink to &quot;PVE macOS安裝紀錄&quot;">​</a></h1><div class="tip custom-block"><p class="custom-block-title">建立時間：2025/03/16</p><ul><li>PVE macOS 安裝紀錄</li><li>PVE 版本 8、Python3.8 以上</li></ul></div><h2 id="_1-下載-iso檔、上傳pve" tabindex="-1">📌 1.下載 ISO檔、上傳PVE <a class="header-anchor" href="#_1-下載-iso檔、上傳pve" aria-label="Permalink to &quot;:pushpin: 1.下載 ISO檔、上傳PVE&quot;">​</a></h2><ul><li><a href="https://github.com/thenickdude/KVM-Opencore/releases" target="_blank" rel="noreferrer">https://github.com/thenickdude/KVM-Opencore/releases</a></li><li>下載 OpenCore-v21.iso.gz、解壓縮 OpenCore-v21.iso</li><li>上傳 OpenCore-v21.iso 到 PVE</li></ul><h2 id="_2-下載-opencore" tabindex="-1">📌 2.下載 OpenCore <a class="header-anchor" href="#_2-下載-opencore" aria-label="Permalink to &quot;:pushpin: 2.下載 OpenCore&quot;">​</a></h2><ul><li><a href="https://github.com/acidanthera/OpenCorePkg" target="_blank" rel="noreferrer">https://github.com/acidanthera/OpenCorePkg</a></li><li>PVE進入shell</li></ul><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://github.com/acidanthera/OpenCorePkg.git</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 下載OpenCore</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> OpenCorePkg/Utilities/macrecovery</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 進入Folder</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 版本對應的命令 : \`recovery_urls.txt\`</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># EX: \`macOS Sonoma 14.5 (23F79)\`</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./macrecovery.py</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -b</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Mac-7BA5B2D9E42DDD94</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -m</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 00000000000000000</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -os</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> latest</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> download</span></span></code></pre></div><ul><li>下載後當前目錄出現並進入 com.apple.recovery.boot</li></ul><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> com.apple.recovery.boot</span></span></code></pre></div><ul><li>BaseSystem.dmg 依選擇版本重新命名: BaseSystem-mac-14.5.dmg</li></ul><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> BaseSystem.dmg</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> BaseSystem-mac-14.5.dmg</span></span></code></pre></div><ul><li>dmg 格式轉為 img</li></ul><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">qemu-img</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> convert</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dmg</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -O</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> raw</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> BaseSystem-mac-14.5.dmg</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> BaseSystem-mac-14.5.img</span></span></code></pre></div><ul><li>img 格式轉為 <code>qcow2</code></li></ul><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">qemu-img</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> convert</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dmg</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -O</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> qcow2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> BaseSystem-mac-14.5.dmg</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> BaseSystem-mac-14.5.qcow2</span></span></code></pre></div><h2 id="_3-pve-設定-kvm-支援-macos" tabindex="-1">📌 3. PVE 設定 KVM 支援 macOS <a class="header-anchor" href="#_3-pve-設定-kvm-支援-macos" aria-label="Permalink to &quot;:pushpin: 3. PVE 設定 KVM 支援 macOS&quot;">​</a></h2><ul><li>ignore_msrs=Y 讓 KVM 忽略 macOS 需要的 MSR 指令（避免 macOS 在虛擬機裡當機）。</li><li>update-initramfs -k all -u 更新 initramfs（初始 RAM 磁碟），確保變更生效。</li></ul><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;options kvm ignore_msrs=Y&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/modprobe.d/kvm.conf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">update-initramfs</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -k</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> all</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -u</span></span></code></pre></div><ul><li>執行上述如果出現以下 GRUB 錯誤，表示系統偵測到 UEFI 模式 但 GRUB 沒有正確安裝 EFI bootloader</li></ul><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Removable</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bootloader</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> found</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> at</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;/boot/efi/EFI/BOOT/BOOTX64.efi&#39;,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> but</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> GRUB</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> packages</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> not</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> up</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> update</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> it!</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> the</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> following</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> command:</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;grub-efi-amd64 grub2/force_efi_extra_removable boolean true&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> debconf-set-selections</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -v</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -u</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Then</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> reinstall</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> GRUB</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> with</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;apt install --reinstall grub-efi-amd64&#39;</span></span></code></pre></div><ul><li>手動強制設定 grub-efi-amd64，然後重新安裝 GRUB。 <ul><li>告訴 Debian 不要阻止 GRUB 設置可移動啟動 (EFI/BOOT/BOOTX64.efi)。</li><li>重新安裝 GRUB EFI 版本 來確保 UEFI 開機正常。</li><li>更新 GRUB 設置 確保 /boot/grub/grub.cfg 是最新的。</li></ul></li></ul><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;grub-efi-amd64 grub2/force_efi_extra_removable boolean true&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> debconf-set-selections</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -v</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -u</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --reinstall</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> grub-efi-amd64</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">update-grub</span></span></code></pre></div><h2 id="_4-pve-建立-macos-虛擬機" tabindex="-1">📌 4. PVE 建立 macOS 虛擬機 <a class="header-anchor" href="#_4-pve-建立-macos-虛擬機" aria-label="Permalink to &quot;:pushpin: 4. PVE 建立 macOS 虛擬機&quot;">​</a></h2><ul><li><p>General</p><ul><li>填寫 VM ID、Name <img src="`+e+'" alt="pve_general"></li></ul></li><li><p>OS</p><ul><li>ISO Image: OpenCore-v21.iso</li><li>Type: Other <img src="'+t+'" alt="pve_os"></li></ul></li><li><p>System</p><ul><li>Graphic card: VMware compatible</li><li>Machine: q35</li><li>BIOS: OVMF (UEFI)</li><li>EFI Storage: 選擇儲存位置</li><li>Pre-Enroll keys: false</li><li>SCSI Controller: VirtIO SCSI single # 單磁碟VM兼容性較佳</li><li>Qemu Agent: true <img src="'+p+'" alt="pve_system"></li></ul></li><li><p>Disks</p><ul><li>Bus/Device: VirtIO Block</li><li>Disk size (GiB): 200 (建議至少60G以上)</li><li>Cache: Write back (unsafe) <img src="'+n+'" alt="pve_disks"></li></ul></li><li><p>CPU</p><ul><li>Cores: 4 核心</li><li>Type: Penryn # Mac虛擬環境需要Intel CPU，Penryn兼容macOS CPU <ul><li>額外補充: host # 直接使用宿主機 (PVE) 的 CPU，較能較高、兼容性較低，適合Windows / Linux 虛擬機</li></ul></li><li>Enable NUMA: true # 每個CPU都有自己一部分RAM，VM會依據NUMA架構，優先使用與CPU最近的RAM最近的RAM <img src="'+h+'" alt="pve_cpu"></li></ul></li><li><p>Memory</p><ul><li>Memory: 8192 # 建議至少8G以上</li><li>Ballooning Device: false # VM 會始終使用固定記憶體，不會動態調整(如Nginx、Web Server) <img src="'+k+'" alt="pve_memory"></li></ul></li><li><p>Network</p><ul><li>Model: VirtIO (paravirtualized)</li><li>Firewall: false <img src="'+r+'" alt="pve_network"></li></ul></li><li><p>回到 PVE Shell，將 qcow2 匯入至你指定的虛擬機(VM ID)</p></li></ul><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">qm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> importdisk</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 204</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> BaseSystem-mac-14.5.qcow2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> local-lvm</span></span></code></pre></div><ul><li>匯入後確認 PVE UI Hardware: Hard Disk 要確認硬碟設定為 VirtIO、Wirte back</li><li>去更改 nano /etc/pve/qemu-server/204.conf <ul><li>其中 (DVD光碟屬性) <code>media=cdrom</code> 改為 <code>cache=unsafe</code></li><li>增加下面這一段到最後面 (該參數只有在 Intel CPU 才可以使用)</li></ul></li></ul><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">args:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -device</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> isa-applesmc,osk=&quot;ourhardworkbythesewordsguardedpleasedontsteal(c)AppleComputerInc&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -smbios</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> type=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -device</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> usb-kbd,bus=ehci.0,port=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -global</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nec-usb-xhci.msi=off</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -global</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ICH9-LPC.acpi-pci-hotplug-with-bridge-support=off</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -cpu</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> host,vendor=GenuineIntel,+invtsc,+hypervisor,kvm=on,vmware-cpuid-freq=on</span></span></code></pre></div><ul><li>PVE調整啟動順序 (Options &gt; Boot Order) <ul><li>OpenCore &gt; BaseSystem-mac-14.5.qcow2</li></ul></li></ul><h2 id="_5-啟動-macos-vm" tabindex="-1">📌 5. 啟動 macOS VM <a class="header-anchor" href="#_5-啟動-macos-vm" aria-label="Permalink to &quot;:pushpin: 5. 啟動 macOS VM&quot;">​</a></h2><ul><li>啟動後進入安裝介面，選擇第四個選項磁碟工具</li><li>下拉選擇顯示所有設備</li><li>選擇磁碟(200G) &gt; Erashes(抹除) <ul><li>輸入磁碟名稱、格式: APFS、方案: GUID &gt; 點擊抹除 &gt; 關閉磁碟工具</li></ul></li><li>選擇第二個安裝macOS &gt; 選擇剛抹掉的磁碟安裝macOS</li><li>安裝成功，進行系統設定 <img src="'+o+'" alt="pve_desktop.png"></li><li>如果出現桌面白屏狀況，則隨便下載張圖片，並將該圖片設定桌布 <img src="'+d+'" alt="pve_imgdesktop.png"></li></ul>',30),g=[F];function u(m,C,y,B,v,b){return i(),a("div",null,g)}const O=s(c,[["render",u]]);export{_ as __pageData,O as default};
